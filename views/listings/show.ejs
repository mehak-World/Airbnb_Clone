<% layout("layouts/boilerplate") -%>
<body>
  <% if(success && success.length){ %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <%= success %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
     
    <% } %>

    <% if(error && error.length){ %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
       
      <% } %>
  <div class="box offset-3">
    <h3>Listing Details</h3>
    <br />
    <img src="<%= listing.image %>" height="200px" width="400px" />
    <br />
    <br />

    <p><b><%= listing.title %></b></p>
    <p><%= listing.description %></p>
    <p>&#8377; <%= listing.price.toLocaleString('en-IN') %></p>
    <p><%= listing.location %></p>
    <p><%= listing.country %></p>
<% if(user){ %>
    <div class="buttons">
      <form action="/listings/<%= listing.id %>/edit">
        <button class="btn">Edit Listing</button>
      </form>
      <form action="/listings/<%= listing.id %>/delete">
        <button class="btn">Delete Listing</button>
      </form>
    </div>
    
    <br />
    <br />
    <div class="review">
      <h4>Leave a Review</h4>
      <br />
      <form
        method="post"
        action="/listings/<%= listing.id %>/reviews"
        class="needs-validation"
        novalidate
      >
        <div class="reviews">
          <label for="rating">Rating</label>
          
          
<fieldset class="starability-basic">
  <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
  <input type="radio" id="first-rate1" name="review[rating]" value="1" />
  <label for="first-rate1" title="Terrible">1 star</label>
  <input type="radio" id="first-rate2" name="review[rating]" value="2" />
  <label for="first-rate2" title="Not good">2 stars</label>
  <input type="radio" id="first-rate3" name="review[rating]" value="3" />
  <label for="first-rate3" title="Average">3 stars</label>
  <input type="radio" id="first-rate4" name="review[rating]" value="4" />
  <label for="first-rate4" title="Very good">4 stars</label>
  <input type="radio" id="first-rate5" name="review[rating]" value="5" />
  <label for="first-rate5" title="Amazing">5 stars</label>
</fieldset>






          <div class="valid-feedback">Looks good!</div>
        </div>

        <div class="reviews">
          <label for="comment">Comment</label>
          <textarea
            name="review[comment]"
            id="comment"
            cols="50"
            rows="2"
            class="form-control"
          ></textarea>
          <div class="valid-feedback">Looks good!</div>
          <div class="invalid-feedback">Enter a valid comment.</div>
        </div>
        <button type="submit" class="btn" id="review-submit">Submit</button>
      </form>
    </div>
    <hr />
    <% } %>
   
  </div>
  <div class="all_reviews">
    <% if(listing.reviews.length) {%>
    
      <div style = "text-align: center">
        <h4>All Reviews</h4>
      </div>
      <br>
    <div class="review-container" style = "width: 800px; position: relative; margin: auto" >
     
      <% for(let review of listing.reviews){ %>
      <div class="card" style="width: 15rem; background: rgba(219, 215, 218, 0.114); box-shadow:black 2px">
        <div class="card-body">
         
          <form method="post" action="/listings/<%= listing.id %>/reviews/<%= review.id %>">
            <p class="card-text">
              <p style = "font-weight: bold">@<%= review.author %></p>
              <p class="starability-result" data-rating="<%= review.rating %>">
                Rated: 3 stars
              </p>
            </p>
            <p class="card-text">
              <b>Comment: </b
              ><textarea id="review_comment" name = "review[comment]" disabled>
<%= review.comment %></textarea
              >
            </p>

            <button id="edit" class="btn save_btn">Edit</button>
          </form>
          <div
          class="icon"
          style="display: flex; justify-content: space-between"
        >
          
           
        <a href="/listings/<%= listing.id %>/reviews/<%= review.id %>"
          ><button style = "padding: 4px; border: none; background: black; color: white; border-radius: 3px">Delete</button>
        </a>
        <p class="card-text" style="text-align: right">
          <%= review.createdAt.getFullYear() + "-" +
          (review.createdAt.toLocaleString('default', { month: 'short' })) +
          "-" + review.createdAt.getDate(); %>
        </p>
        </div>
        
        </div>
      </div>
      <% } %>
    </div>
    <% } %>
  </div>
</body>
